<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="style.css"/>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Latest iPhone Store</title>
</head>
<body>

<header>ðŸ“± Latest iPhone Store</header>

<div class="search-filter">
  <input type="text" id="searchBar" placeholder="Search for an iPhone...">
  <select id="categoryFilter">
    <option value="all">All Models</option>
    <option value="SE">iPhone SE</option>
    <option value="13">iPhone 13</option>
    <option value="14">iPhone 14</option>
  </select>
</div>

<div class="container" id="product-list"></div>

<div class="cart-container">
  <h2>ðŸ›’ Shopping Cart</h2>
  <ul id="cart-items"></ul>
  <p><strong>Total:</strong> R<span id="cart-total">0</span></p>

  <!-- PayFast Form -->
  <form id="payfastForm" action="https://sandbox.payfast.co.za/eng/process" method="post" target="_self">
    <input type="hidden" name="merchant_id" value="10041161">
    <input type="hidden" name="merchant_key" value="jgc9w0rd4u873">
    <input type="hidden" name="amount" id="pf_amount" value="">
    <input type="hidden" name="item_name" id="pf_item_name" value="">
    <input type="hidden" name="return_url" value="https://your-site.netlify.app/success.html">
    <input type="hidden" name="cancel_url" value="https://your-site.netlify.app/cancel.html">
    <input type="hidden" name="notify_url" value="https://your-site.netlify.app/.netlify/functions/payfast-itn">
    
    <!-- Customer Details -->
    <label>First Name:</label>
    <input type="text" name="name_first" required><br><br>

    <label>Last Name:</label>
    <input type="text" name="name_last" required><br><br>

    <label>Email:</label>
    <input type="email" name="email_address" required><br><br>

  </form>

  <button id="checkout-btn">Checkout & Pay</button>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const products = [
    { name: "iPhone SE (2022)", price: 200, category: "SE", image: "Apple 2.png" },
    { name: "iPhone 13", price: 13999, category: "13", image: "Apple 2.png" },
    { name: "iPhone 13 Pro", price: 18999, category: "13", image: "Apple 2.png" },
    { name: "iPhone 14 Pro Max", price: 23999, category: "14", image: "Apple 2.png" }
  ];

  const productList = document.getElementById("product-list");
  const searchBar = document.getElementById("searchBar");
  const categoryFilter = document.getElementById("categoryFilter");
  let cart = [];

  function renderProducts() {
    productList.innerHTML = "";
    const searchText = searchBar.value.toLowerCase();
    const category = categoryFilter.value;

    products
      .filter(p => p.name.toLowerCase().includes(searchText) &&
                   (category === "all" || p.category === category))
      .forEach(product => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${product.image}" alt="${product.name}">
          <div class="card-content">
            <h3>${product.name}</h3>
            <p class="price">R${product.price}</p>
            <button class="buy-btn">Add to Cart</button>
          </div>
        `;
        card.querySelector(".buy-btn").addEventListener("click", () => addToCart(product));
        productList.appendChild(card);
      });
  }

  function addToCart(product) {
    cart.push(product);
    renderCart();
  }

  function removeFromCart(index) {
    cart.splice(index, 1);
    renderCart();
  }

  function renderCart() {
    const cartItems = document.getElementById("cart-items");
    const cartTotal = document.getElementById("cart-total");

    cartItems.innerHTML = "";
    let total = 0;
    let itemNames = [];

    cart.forEach((item, index) => {
      total += item.price;
      itemNames.push(item.name);
      const li = document.createElement("li");
      li.innerHTML = `
        ${item.name} - R${item.price}
        <button class="remove-btn">Remove</button>
      `;
      li.querySelector(".remove-btn").addEventListener("click", () => removeFromCart(index));
      cartItems.appendChild(li);
    });

    cartTotal.textContent = total;

    // Update PayFast hidden fields
    document.getElementById("pf_amount").value = total.toFixed(2);
    document.getElementById("pf_item_name").value = itemNames.join(", ");
  }

  searchBar.addEventListener("input", renderProducts);
  categoryFilter.addEventListener("change", renderProducts);
  renderProducts();

  // Checkout Button
  document.getElementById("checkout-btn").addEventListener("click", function(e){
      e.preventDefault(); // prevent normal form submission

      if(cart.length === 0){
          alert("Your cart is empty!");
          return;
      }

      const firstName = prompt("Enter your first name:");
      const lastName = prompt("Enter your last name:");
      const email = prompt("Enter your email:");

      if(!firstName || !lastName || !email) {
          alert("Please provide all details to proceed to payment.");
          return;
      }

      // Fill hidden PayFast fields
      document.getElementById("pf_first_name").value = firstName;
      document.getElementById("pf_last_name").value = lastName;
      document.getElementById("pf_email").value = email;

      // Submit PayFast form
      document.getElementById("payfastForm").submit();
  });
});
</script>

</body>
</html>
